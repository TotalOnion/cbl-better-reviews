!function(){"use strict";const e="/wp-json/cbl-better-reviews/v1";async function t(e="",t={}){return(await fetch(e,{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(t)})).json()}async function r(e=""){return(await fetch(e,{method:"GET",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}var a=(r,a,o,i)=>{t(`${e}/review/${r}`,a).then(o,i)},o=(t,a,o)=>{r(`${e}/reviews/${t}`).then(a,o)};const i={localStorageKey:"better-reviews-my-reviews",dataAttributes:{reviewContainer:"data-better-reviews-review-id",averageStarsContainer:"data-better-reviews-review-average-stars",averageReviewCount:"data-better-reviews-average-review-count",subcriteriaContainer:"data-better-reviews-subcriteria-id",subcriteriaScoreContainer:"data-better-reviews-subcriteria-score",subcriteriaStarsContainer:"data-better-reviews-subcriteria-stars",subcriteriaReviewCount:"data-better-reviews-subcriteria-review-count",averageScoreContainer:"data-better-reviews-review-average-score"},classNames:{notYetReviewed:"better-reviews__not-yet-reviewed",hasPersonallyLiked:"better-reviews__has-personally-reviewed"},starClassnames:["better-reviews__star_05","better-reviews__star_10","better-reviews__star_15","better-reviews__star_20","better-reviews__star_25","better-reviews__star_30","better-reviews__star_35","better-reviews__star_40","better-reviews__star_45","better-reviews__star_50"]};function s(e,t,r){e.innerText=(t/r).toFixed(1)}function n(e,t,r){i.starClassnames.forEach((t=>e.classList.remove(t)));const a=.5*Math.round(t/r/.5),o="better-reviews__star_"+(String(a).replace(".","")+"0").substring(0,2);e.classList.add(o)}function c(e,t){let r="";r=t>Math.pow(10,6)?(t/Math.pow(10,6)).toFixed(1)+"M":t>Math.pow(10,3)?(t/Math.pow(10,3)).toFixed(1)+"K":t,e.innerText=r}var l=function(){document,document.addEventListener("better-reviews:reviews-loaded",(e=>{var t;t=e.detail,document.querySelectorAll(`[${i.dataAttributes.reviewContainer}]`).forEach((e=>{const r=e.getAttribute(i.dataAttributes.reviewContainer);!function(e,t){0!=t.totals.count?(e.classList.remove(i.classNames.notYetReviewed),function(e,t){e.querySelectorAll(`[${i.dataAttributes.subcriteriaContainer}]`).forEach((e=>{const r=e.getAttribute(i.dataAttributes.subcriteriaContainer);!function(e,t){e.querySelectorAll(`[${i.dataAttributes.subcriteriaScoreContainer}]`).forEach((e=>s(e,t.total,t.count))),e.querySelectorAll(`[${i.dataAttributes.subcriteriaStarsContainer}]`).forEach((e=>n(e,t.total,t.count))),e.querySelectorAll(`[${i.dataAttributes.subcriteriaReviewCount}]`).forEach((e=>c(e,t.count)))}(e,t[r])}))}(e,t),function(e,t){e.querySelectorAll(`[${i.dataAttributes.averageScoreContainer}]`).forEach((e=>s(e,t.totals.total,t.totals.count))),e.querySelectorAll(`[${i.dataAttributes.averageStarsContainer}]`).forEach((e=>n(e,t.totals.total,t.totals.count))),e.querySelectorAll(`[${i.dataAttributes.averageReviewCount}]`).forEach((e=>c(e,t.totals.count)))}(e,t)):e.classList.add(i.classNames.notYetReviewed)}(e,t[r])}))})),function(){const e=[];document.querySelectorAll(`[${i.dataAttributes.reviewContainer}]`).forEach((t=>{const r=t.getAttribute(i.dataAttributes.reviewContainer);r&&e.push(r)})),e.length?o(e,(e=>{const t=new CustomEvent("better-reviews:reviews-loaded",{detail:e});document.dispatchEvent(t)}),((e,t,r,a)=>{console.error("Fail!!",e,t,r,a)})):console.warn("The better reviews js has been loaded, but there are no valid IDs on the page to fetch")}()};const d="data-better-reviews-modal-toggle",u="data-better-reviews-review-id",v="data-better-reviews-modal-review-id",w="better-reviews__modal-is-open";function b(e){e.querySelectorAll(`[${d}]`).forEach((e=>{e.addEventListener("click",h,{passive:!0})})),e.querySelectorAll(`[${v}] form`).forEach((e=>{e.addEventListener("submit",f)}))}function h(e){switch(console.log("toggling modal"),e.target.getAttribute(d)){case"close":return document.body.classList.remove(w),void document.querySelectorAll(`[${v}]`).forEach((e=>{e.parentNode.removeChild(e)}));case"open":return void function(e){const t=e.target.closest(`[${u}]`).querySelector("template");if(!t)return void console.error(" -- No modal template found.");const r=t.content.cloneNode(!0);b(r),document.body.prepend(r),document.body.classList.add(w)}(e);default:console.error(" -- Unknown toggleModal value")}}function f(e){e.preventDefault();const t=Object.fromEntries(new FormData(e.target)),r=e.target.closest(`[${v}]`).getAttribute(v);a(r,t,(e=>{const t=new CustomEvent("better-reviews:reviews-loaded",{detail:e});document.dispatchEvent(t)}),(e=>{console.log("Error!!",e)}))}var m=function(){b(document)};window.addEventListener("DOMContentLoaded",(()=>{m(),l()}))}();