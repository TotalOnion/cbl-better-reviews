!function(){"use strict";var e=e=>{if("object"==typeof localStorage)return localStorage.getItem(e);{const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null}},t=(e,t)=>{if("object"==typeof localStorage)return localStorage.setItem(e,t);document.cookie=e+"="+t};const r="better-reviews";function a(){const t=e(r);return t?t.split(","):[]}var s={get:a,add:function(e){const s=a();return s.indexOf(e)<0&&(s.push(e),function(e){t(r,e.filter(((e,t,r)=>r.indexOf(e)===t)))}(s)),s}};const o="/wp-json/cbl-better-reviews/v1";async function i(e="",t={}){return(await fetch(e,{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(t)})).json()}async function n(e=""){return(await fetch(e,{method:"GET",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}var c=(e,t)=>i(`${o}/review/${e}`,t),l=e=>n(`${o}/reviews/${e}`);const d={localStorageKey:"better-reviews-my-reviews",dataAttributes:{reviewContainer:"data-better-reviews-review-id",averageStarsContainer:"data-better-reviews-review-average-stars",averageReviewCount:"data-better-reviews-average-review-count",subcriteriaContainer:"data-better-reviews-subcriteria-id",subcriteriaScoreContainer:"data-better-reviews-subcriteria-score",subcriteriaStarsContainer:"data-better-reviews-subcriteria-stars",subcriteriaReviewCount:"data-better-reviews-subcriteria-review-count",averageScoreContainer:"data-better-reviews-review-average-score"},classNames:{hasNoReviews:"better-reviews__has-no-reviews",notPersonallyReviewed:"better-reviews__not-personally-reviewed",hasPersonallyReviewed:"better-reviews__has-personally-reviewed"},starClassnames:["better-reviews__star_05","better-reviews__star_10","better-reviews__star_15","better-reviews__star_20","better-reviews__star_25","better-reviews__star_30","better-reviews__star_35","better-reviews__star_40","better-reviews__star_45","better-reviews__star_50"]};function u(e,t,r){e.innerText=(t/r).toFixed(1)}function v(e,t,r){d.starClassnames.forEach((t=>e.classList.remove(t)));const a=.5*Math.round(t/r/.5),s="better-reviews__star_"+(String(a).replace(".","")+"0").substring(0,2);e.classList.add(s)}function w(e,t){let r="";r=t>Math.pow(10,6)?(t/Math.pow(10,6)).toFixed(1)+"M":t>Math.pow(10,3)?(t/Math.pow(10,3)).toFixed(1)+"K":t,e.innerText=r}var b=function(){window.test=s,document,document.addEventListener("better-reviews:reviews-loaded",(e=>{var t;t=e.detail,document.querySelectorAll(`[${d.dataAttributes.reviewContainer}]`).forEach((e=>{const r=e.getAttribute(d.dataAttributes.reviewContainer);!function(e,t,r){0!=t.totals.count?(e.classList.remove(d.classNames.hasNoReviews),s.get().indexOf(r)>=0?(e.classList.add(d.classNames.hasPersonallyReviewed),e.classList.remove(d.classNames.notPersonallyReviewed)):(e.classList.add(d.classNames.notPersonallyReviewed),e.classList.remove(d.classNames.hasPersonallyReviewed)),function(e,t){e.querySelectorAll(`[${d.dataAttributes.subcriteriaContainer}]`).forEach((e=>{const r=e.getAttribute(d.dataAttributes.subcriteriaContainer);!function(e,t){e.querySelectorAll(`[${d.dataAttributes.subcriteriaScoreContainer}]`).forEach((e=>u(e,t.total,t.count))),e.querySelectorAll(`[${d.dataAttributes.subcriteriaStarsContainer}]`).forEach((e=>v(e,t.total,t.count))),e.querySelectorAll(`[${d.dataAttributes.subcriteriaReviewCount}]`).forEach((e=>w(e,t.count)))}(e,t[r])}))}(e,t),function(e,t){e.querySelectorAll(`[${d.dataAttributes.averageScoreContainer}]`).forEach((e=>u(e,t.totals.total,t.totals.count))),e.querySelectorAll(`[${d.dataAttributes.averageStarsContainer}]`).forEach((e=>v(e,t.totals.total,t.totals.count))),e.querySelectorAll(`[${d.dataAttributes.averageReviewCount}]`).forEach((e=>w(e,t.totals.count)))}(e,t)):e.classList.add(d.classNames.hasNoReviews)}(e,t[r],r)})),better_reviews_config.current_page_id&&s.get().indexOf(better_reviews_config.current_page_id)>=0?(document.body.classList.add(d.classNames.hasPersonallyReviewed),document.body.classList.remove(d.classNames.notPersonallyReviewed)):(document.body.classList.add(d.classNames.notPersonallyReviewed),document.body.classList.remove(d.classNames.hasPersonallyReviewed))})),function(){let e=[];document.querySelectorAll(`[${d.dataAttributes.reviewContainer}]`).forEach((t=>{const r=t.getAttribute(d.dataAttributes.reviewContainer);r&&e.push(r)})),e=e.filter(((e,t,r)=>r.indexOf(e)===t)),e.length?l(e).then((e=>{const t=new CustomEvent("better-reviews:reviews-loaded",{detail:e});document.dispatchEvent(t)}),(e=>{console.error(" - Better Reviews: load reviews failed with:",e)})):console.warn(" - Better Reviews: js has been loaded, but there are no valid IDs on the page to fetch")}()};const m="data-better-reviews-modal-toggle",f="data-better-reviews-review-id",h="data-better-reviews-modal-review-id",_="data-better-reviews-modal-submit",g="data-better-reviews-modal-star-rating-input",y="better-reviews__modal-is-open",p="better-reviews__modal-succeeded",A="better-reviews__modal-failed",E="better-reviews__modal-invalid",S="BUTTON_DISABLED",L="BUTTON_ENABLED";function C(e,t){e.querySelectorAll(`[${_}]`).forEach((e=>{switch(t){case S:e.setAttribute("disabled",!0);break;case L:e.removeAttribute("disabled")}}))}function N(e){e.querySelectorAll(`[${m}]`).forEach((e=>{e.addEventListener("click",R,{passive:!0})})),e.querySelectorAll(`[${g}]`).forEach((e=>{e.addEventListener("change",q,{passive:!0})})),e.querySelectorAll(`[${h}] form`).forEach((e=>{e.addEventListener("submit",$)}))}function R(e){switch(e.target.getAttribute(m)){case"close":return console.log("Closing modal"),document.body.classList.remove(y),document.body.classList.remove(A),document.body.classList.remove(p),void document.querySelectorAll(`[${h}]`).forEach((e=>{console.log("ll",e),e.parentNode.removeChild(e)}));case"open":return void function(e){const t=e.target.closest(`[${f}]`).querySelector("template");if(!t)return void console.error(" -- No modal template found.");const r=t.content.cloneNode(!0);N(r),document.body.prepend(r),document.body.classList.add(y)}(e);default:console.error(" -- Unknown toggleModal value")}}function $(e){e.preventDefault();const t=Object.fromEntries(new FormData(e.target)),r=e.target.closest(`[${h}]`).getAttribute(h);c(r,t).then((e=>{document.body.classList.remove(A),document.body.classList.add(p),s.add(r);const t=new CustomEvent("better-reviews:reviews-loaded",{detail:e});document.dispatchEvent(t)}),(e=>{document.body.classList.remove(p),document.body.classList.add(A),console.log("Error!!",e)}))}function q(e){const t=e.target.closest("form"),r=Object.fromEntries(new FormData(t));0===Object.keys(r).length?(t.classList.add(E),C(t,S)):(t.classList.remove(E),C(t,L))}var O=function(){N(document)};window.addEventListener("DOMContentLoaded",(()=>{O(),b()}))}();