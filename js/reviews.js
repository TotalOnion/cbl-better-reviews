!function(){"use strict";var e=e=>{if("object"==typeof localStorage)return localStorage.getItem(e);{const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null}},t=(e,t)=>{if("object"==typeof localStorage)return localStorage.setItem(e,t);document.cookie=e+"="+t};const r="better-reviews";function a(){const t=e(r);return t?t.split(","):[]}var i={get:a,add:function(e){const i=a();return i.indexOf(e)<0&&(i.push(e),function(e){t(r,e.filter(((e,t,r)=>r.indexOf(e)===t)))}(i)),i}};const s="/wp-json/cbl-better-reviews/v1";async function o(e="",t={}){return(await fetch(e,{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(t)})).json()}async function n(e=""){return(await fetch(e,{method:"GET",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}var c=(e,t)=>o(`${s}/review/${e}`,t),d=e=>n(`${s}/reviews/${e}`);const l={localStorageKey:"better-reviews-my-reviews",dataAttributes:{reviewContainer:"data-better-reviews-review-id",averageContainer:"data-better-reviews-review-average",averageStarsContainer:"data-better-reviews-review-average-stars",averageReviewCount:"data-better-reviews-average-review-count",criteriaContainer:"data-better-reviews-criteria-id",criteriaScoreContainer:"data-better-reviews-criteria-score",criteriaStarsContainer:"data-better-reviews-criteria-stars",criteriaReviewCount:"data-better-reviews-criteria-review-count",averageScoreContainer:"data-better-reviews-review-average-score",criteriaNotYetReviewedLabel:"data-better-reviews-review-criteria-not-yet-reviewed-label",criteriaNotYetReviewedLabelText:"data-better-reviews-criteria-not-yet-reviewed-label"},classNames:{hasNoReviews:"better-reviews__has-no-reviews",notPersonallyReviewed:"better-reviews__not-personally-reviewed",hasPersonallyReviewed:"better-reviews__has-personally-reviewed",criteriaNotYetReviewed:"better-reviews__criteria-not-yet-reviewed",criteriaNotYetReviewedLabel:"better-reviews__criteria-not-yet-reviewed-label"},starClassnames:["better-reviews__star_05","better-reviews__star_10","better-reviews__star_15","better-reviews__star_20","better-reviews__star_25","better-reviews__star_30","better-reviews__star_35","better-reviews__star_40","better-reviews__star_45","better-reviews__star_50"]};function v(e,t,r){e.innerText=(t/r).toFixed(1)}function u(e,t,r){l.starClassnames.forEach((t=>e.classList.remove(t)));const a=.5*Math.round(t/r/.5),i="better-reviews__star_"+(String(a).replace(".","")+"0").substring(0,2);e.classList.add(i)}function w(e,t){let r="";r=t>Math.pow(10,6)?(t/Math.pow(10,6)).toFixed(1)+"M":t>Math.pow(10,3)?(t/Math.pow(10,3)).toFixed(1)+"K":t,e.innerText=r}var b=function(){document,document.addEventListener("better-reviews:reviews-loaded",(e=>{var t;t=e.detail,document.querySelectorAll(`[${l.dataAttributes.reviewContainer}]`).forEach((e=>{const r=e.getAttribute(l.dataAttributes.reviewContainer);!function(e,t,r){0==t.totals.count?e.classList.add(l.classNames.hasNoReviews):e.classList.remove(l.classNames.hasNoReviews),i.get().indexOf(r)>=0?(e.classList.add(l.classNames.hasPersonallyReviewed),e.classList.remove(l.classNames.notPersonallyReviewed)):(e.classList.add(l.classNames.notPersonallyReviewed),e.classList.remove(l.classNames.hasPersonallyReviewed)),function(e,t){e.querySelectorAll(`[${l.dataAttributes.criteriaContainer}]`).forEach((e=>{const r=e.getAttribute(l.dataAttributes.criteriaContainer);!function(e,t){if(!t.count){const t=document.createElement("p");return t.classList.add(l.classNames.criteriaNotYetReviewedLabel),t.innerText=e.getAttribute(l.dataAttributes.criteriaNotYetReviewedLabelText),t.setAttribute(l.dataAttributes.criteriaNotYetReviewedLabel,!0),e.appendChild(t),void e.classList.add(l.classNames.criteriaNotYetReviewed)}e.classList.remove(l.classNames.criteriaNotYetReviewed),e.querySelectorAll(`[${l.dataAttributes.criteriaNotYetReviewedLabel}]`).forEach((e=>e.parentNode.removeChild(e))),e.querySelectorAll(`[${l.dataAttributes.criteriaScoreContainer}]`).forEach((e=>v(e,t.total,t.count))),e.querySelectorAll(`[${l.dataAttributes.criteriaStarsContainer}]`).forEach((e=>u(e,t.total,t.count))),e.querySelectorAll(`[${l.dataAttributes.criteriaReviewCount}]`).forEach((e=>w(e,t.count)))}(e,t[r])}))}(e,t),function(e,t){const r=e.querySelector(`[${l.dataAttributes.averageContainer}]`);if(r){if(!t.totals.count){const e=document.createElement("p");return e.classList.add(l.classNames.criteriaNotYetReviewedLabel),e.innerText=r.getAttribute(l.dataAttributes.criteriaNotYetReviewedLabelText),e.setAttribute(l.dataAttributes.criteriaNotYetReviewedLabel,!0),r.appendChild(e),void r.classList.add(l.classNames.criteriaNotYetReviewed)}r.classList.remove(l.classNames.criteriaNotYetReviewed),r.querySelectorAll(`[${l.dataAttributes.criteriaNotYetReviewedLabel}]`).forEach((e=>e.parentNode.removeChild(e))),r.querySelectorAll(`[${l.dataAttributes.averageScoreContainer}]`).forEach((e=>v(e,t.totals.total,t.totals.count))),r.querySelectorAll(`[${l.dataAttributes.averageStarsContainer}]`).forEach((e=>u(e,t.totals.total,t.totals.count))),r.querySelectorAll(`[${l.dataAttributes.averageReviewCount}]`).forEach((e=>w(e,t.totals.count)))}}(e,t)}(e,t[r],r)})),betterReviewsConfig.currentPageId&&i.get().indexOf(betterReviewsConfig.currentPageId)>=0?(document.body.classList.add(l.classNames.hasPersonallyReviewed),document.body.classList.remove(l.classNames.notPersonallyReviewed)):(document.body.classList.add(l.classNames.notPersonallyReviewed),document.body.classList.remove(l.classNames.hasPersonallyReviewed))})),function(){let e=[];document.querySelectorAll(`[${l.dataAttributes.reviewContainer}]`).forEach((t=>{const r=t.getAttribute(l.dataAttributes.reviewContainer);r&&e.push(r)})),e=e.filter(((e,t,r)=>r.indexOf(e)===t)),e.length?d(e).then((e=>{const t=new CustomEvent("better-reviews:reviews-loaded",{detail:e});document.dispatchEvent(t)}),(e=>{console.error(" - Better Reviews: load reviews failed with:",e)})):console.warn(" - Better Reviews: js has been loaded, but there are no valid IDs on the page to fetch")}()};const m="data-better-reviews-modal-toggle",f="data-better-reviews-review-id",h="data-better-reviews-modal-review-id",y="data-better-reviews-modal-submit",g="data-better-reviews-modal-star-rating-input",_="better-reviews__modal-is-open",A="better-reviews__modal-succeeded",L="better-reviews__modal-failed",N="better-reviews__modal-invalid",p="BUTTON_DISABLED",R="BUTTON_ENABLED";function E(e,t){e.querySelectorAll(`[${y}]`).forEach((e=>{switch(t){case p:e.setAttribute("disabled",!0);break;case R:e.removeAttribute("disabled")}}))}function C(e){e.querySelectorAll(`[${m}]`).forEach((e=>{e.addEventListener("click",S,{passive:!0})})),e.querySelectorAll(`[${g}]`).forEach((e=>{e.addEventListener("change",q,{passive:!0})})),e.querySelectorAll(`[${h}] form`).forEach((e=>{e.addEventListener("submit",$)}))}function S(e){switch(e.target.getAttribute(m)){case"close":return document.body.classList.remove(_),document.body.classList.remove(L),document.body.classList.remove(A),void document.querySelectorAll(`[${h}]`).forEach((e=>{e.parentNode.removeChild(e)}));case"open":return void function(e){const t=e.target.closest(`[${f}]`).querySelector("template");if(!t)return void console.error(" -- No modal template found.");const r=t.content.cloneNode(!0);C(r),document.body.prepend(r),document.body.classList.add(_)}(e);default:console.error(" -- Unknown toggleModal value")}}function $(e){e.preventDefault();const t=Object.fromEntries(new FormData(e.target)),r=e.target.closest(`[${h}]`).getAttribute(h);c(r,t).then((e=>{document.body.classList.remove(L),document.body.classList.add(A),i.add(r);const t=new CustomEvent("better-reviews:reviews-loaded",{detail:e});document.dispatchEvent(t)}),(e=>{document.body.classList.remove(A),document.body.classList.add(L),console.error(" - Better Reviews: Error sending review form. Error was:",e)}))}function q(e){const t=e.target.closest("form"),r=Object.fromEntries(new FormData(t));0===Object.keys(r).length?(t.classList.add(N),E(t,p)):(t.classList.remove(N),E(t,R))}var x=function(){C(document)};window.addEventListener("DOMContentLoaded",(()=>{x(),b()}))}();